<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="消息中间件,ActiveMQ,">










<meta name="description" content="Java Message Service 消息中间件的组成 消息机制-点对点与发布订阅 消息中间件的应用场景">
<meta name="keywords" content="消息中间件,ActiveMQ">
<meta property="og:type" content="article">
<meta property="og:title" content="MQ详解及中间件产品比较">
<meta property="og:url" content="http://yoursite.com/2019/01/17/MQ详解及中间件产品比较/index.html">
<meta property="og:site_name" content="nexxt95">
<meta property="og:description" content="Java Message Service 消息中间件的组成 消息机制-点对点与发布订阅 消息中间件的应用场景">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="c:/Users/nexxt/Desktop/Temp.assets/20180417-1.png">
<meta property="og:image" content="c:/Users/nexxt/Desktop/Temp.assets/20180417-2.png">
<meta property="og:image" content="c:/Users/nexxt/Desktop/Temp.assets/20170816171523564.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/1.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/2.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/3.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/4.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/5.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/点对点.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/聊天室.jpg">
<meta property="og:image" content="c:/Users/nexxt/Desktop/消息队列概述.assets/电商.jpg">
<meta property="og:image" content="f:/Hexo/test/source/_posts/activeMQ1/日志.jpg">
<meta property="og:updated_time" content="2019-01-20T02:33:48.491Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MQ详解及中间件产品比较">
<meta name="twitter:description" content="Java Message Service 消息中间件的组成 消息机制-点对点与发布订阅 消息中间件的应用场景">
<meta name="twitter:image" content="c:/Users/nexxt/Desktop/Temp.assets/20180417-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/01/17/MQ详解及中间件产品比较/">





  <title>MQ详解及中间件产品比较 | nexxt95</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">nexxt95</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">致力成为中国倒数第一,世界倒数的Java开发者</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/17/MQ详解及中间件产品比较/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nexxt95">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nexxt95">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MQ详解及中间件产品比较</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-17T21:41:12+08:00">
                2019-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/消息中间件/" itemprop="url" rel="index">
                    <span itemprop="name">消息中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <ul>
<li>Java Message Service</li>
<li>消息中间件的组成</li>
<li>消息机制-点对点与发布订阅</li>
<li>消息中间件的应用场景<a id="more"></a>
</li>
</ul>
<h1 id="MQ详解及中间件产品比较"><a href="#MQ详解及中间件产品比较" class="headerlink" title="MQ详解及中间件产品比较"></a>MQ详解及中间件产品比较</h1><h2 id="1-jms的概念"><a href="#1-jms的概念" class="headerlink" title="1.jms的概念"></a>1.jms的概念</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">它是一种与厂商无关的API，用来访问消息收发系统消息。它类似于JDBC，JDBC是可以用来访问不同关系数据库的API，而JMS则提供同样与厂商无关的访问消息收发服务的方法,这样就可以通过消息收发服务实现从一个JMS客户机向另一个JMS客户机发送消息，所需要的是厂商支持JMS。换句话说，JMS是Java平台上有关面向消息中间件的技术规范，不同的的中间件产品是对jms接口的不同实现。</span><br></pre></td></tr></table></figure>
<h2 id="2-jms中关键的对象"><a href="#2-jms中关键的对象" class="headerlink" title="2.jms中关键的对象"></a>2.jms中关键的对象</h2><ul>
<li><p>ConnectionFactory 连接工厂</p>
</li>
<li><p>Connection  连接对象</p>
</li>
<li><p>Session，是发送和接收消息的上下文，用于创建消息生产者，消息消费者，相比rocketMQ会话session是提供事务性的；</p>
</li>
<li><p>destination，指定生产消息的目的地和消费消息的来源对象；生产者、消费者，由会话创建的对象，顾名思义，分为队列和订阅两种。</p>
</li>
</ul>
<h2 id="3-消息中间件的组成"><a href="#3-消息中间件的组成" class="headerlink" title="3.消息中间件的组成"></a>3.消息中间件的组成</h2><ul>
<li>Broken ：   消息服务器，作为server提供消息核心服务</li>
<li>Producer：消息生产者，业务发起方，负责生产消息传输给broker</li>
<li>Consumer：消息消费者，业务的处理方，负责从broken获取消息并进行业务逻辑处理</li>
<li>Topic： 主体，发布订阅模式下的统一汇集地，与Queue不同是两种方式。</li>
<li>Queue：队列，PTP(点对点模式)，特定生产者向queue发送消息。</li>
<li>Message：消息体，根据不同通信协议的固定格式进行编码的数据包，封装业务数据，以消息形式传送</li>
</ul>
<h2 id="4-消息机制-点对点与发布订阅"><a href="#4-消息机制-点对点与发布订阅" class="headerlink" title="4.消息机制-点对点与发布订阅"></a>4.消息机制-点对点与发布订阅</h2><h6 id="1-p2p-点对点"><a href="#1-p2p-点对点" class="headerlink" title="1.p2p(点对点)"></a>1.p2p(点对点)</h6><ul>
<li>一个消息只用一个消费者(消息消费即删除)</li>
<li>发送者和消费者时间上没有依赖性</li>
<li>接收消息之后需向队列发送回执信息</li>
<li>目的地必须是队列</li>
</ul>
<p>应用场景:订单和商品,应用解耦</p>
<p><img src="C:\Users\nexxt\Desktop\Temp.assets\20180417-1.png" alt=""></p>
<h6 id="2-pub-and-sub-发布订阅"><a href="#2-pub-and-sub-发布订阅" class="headerlink" title="2.pub and sub(发布订阅)"></a>2.pub and sub(发布订阅)</h6><ul>
<li>一个消息有多个消费者</li>
<li>时间上有依赖性(后来的消费者无法消费订阅到以前的消息)</li>
</ul>
<p>应用场景:app的消息推送</p>
<p><img src="C:\Users\nexxt\Desktop\Temp.assets\20180417-2.png" alt=""></p>
<h2 id="5-消息中间件的优势"><a href="#5-消息中间件的优势" class="headerlink" title="5.消息中间件的优势"></a>5.消息中间件的优势</h2><h5 id="1）系统解耦"><a href="#1）系统解耦" class="headerlink" title="1）系统解耦"></a>1）系统解耦</h5><p>交互系统之间没有直接的调用关系，只是通过消息传输，故系统侵入性不强，耦合度低。</p>
<h5 id="2）提高系统响应时间"><a href="#2）提高系统响应时间" class="headerlink" title="2）提高系统响应时间"></a>2）提高系统响应时间</h5><p>例如原来的一套逻辑，完成支付可能涉及先修改订单状态、计算会员积分、通知物流配送几个逻辑才能完成；通过MQ架构设计，就可将紧急重要（需要立刻响应）的业务放到该调用方法中，响应要求不高的使用消息队列，放到MQ队列中，供消费者处理。</p>
<h5 id="3）为大数据处理架构提供服务"><a href="#3）为大数据处理架构提供服务" class="headerlink" title="3）为大数据处理架构提供服务"></a>3）<strong>为大数据处理架构提供服务</strong></h5><p>通过消息作为整合，大数据的背景下，消息队列还与实时处理架构整合，为数据处理提供性能支持。</p>
<h2 id="6-消息中间件的应用场景"><a href="#6-消息中间件的应用场景" class="headerlink" title="6.消息中间件的应用场景"></a>6.消息中间件的应用场景</h2><h5 id="1）异步通信"><a href="#1）异步通信" class="headerlink" title="1）异步通信"></a>1）异步通信</h5><p>有些业务不想也不需要立即处理消息。消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。想向队列中放入多少消息就放多少，然后在需要的时候再去处理它们。</p>
<h5 id="2）解耦"><a href="#2）解耦" class="headerlink" title="2）解耦"></a>2）解耦</h5><p>降低工程间的强依赖程度，针对异构系统进行适配。在项目启动之初来预测将来项目会碰到什么需求，是极其困难的。通过消息系统在处理过程中间插入了一个隐含的、基于数据的接口层，两边的处理过程都要实现这一接口，当应用发生变化时，可以独立的扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束。</p>
<h5 id="3）冗余"><a href="#3）冗余" class="headerlink" title="3）冗余"></a>3）冗余</h5><p>有些情况下，处理数据的过程会失败。除非数据被持久化，否则将造成丢失。消息队列把数据进行持久化直到它们已经被完全处理，通过这一方式规避了数据丢失风险。许多消息队列所采用的”插入-获取-删除”范式中，在把一个消息从队列中删除之前，需要你的处理系统明确的指出该消息已经被处理完毕，从而确保你的数据被安全的保存直到你使用完毕。</p>
<h5 id="4）扩展性"><a href="#4）扩展性" class="headerlink" title="4）扩展性"></a>4）扩展性</h5><p>因为消息队列解耦了你的处理过程，所以增大消息入队和处理的频率是很容易的，只要另外增加处理过程即可。不需要改变代码、不需要调节参数。便于分布式扩容。</p>
<h5 id="5）过载保护"><a href="#5）过载保护" class="headerlink" title="5）过载保护"></a>5）过载保护</h5><p>在访问量剧增的情况下，应用仍然需要继续发挥作用，但是这样的突发流量无法提取预知；如果以为了能处理这类瞬间峰值访问为标准来投入资源随时待命无疑是巨大的浪费。使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。</p>
<h5 id="6）可恢复性"><a href="#6）可恢复性" class="headerlink" title="6）可恢复性"></a>6）可恢复性</h5><p>系统的一部分组件失效时，不会影响到整个系统。消息队列降低了进程间的耦合度，所以即使一个处理消息的进程挂掉，加入队列中的消息仍然可以在系统恢复后被处理。</p>
<h5 id="7）顺序保证"><a href="#7）顺序保证" class="headerlink" title="7）顺序保证"></a>7）顺序保证</h5><p>在大多使用场景下，数据处理的顺序都很重要（如秒杀商品）。大部分消息队列本来就是排序的，并且能保证数据会按照特定的顺序来处理。</p>
<h5 id="8）缓冲"><a href="#8）缓冲" class="headerlink" title="8）缓冲"></a>8）缓冲</h5><p>在任何重要的系统中，都会有需要不同的处理时间的元素。消息队列通过一个缓冲层来帮助任务最高效率的执行，该缓冲有助于控制和优化数据流经过系统的速度。以调节系统响应时间。</p>
<h5 id="9）数据流处理"><a href="#9）数据流处理" class="headerlink" title="9）数据流处理"></a>9）数据流处理</h5><p>分布式系统产生的海量数据流，如：业务日志、监控数据、用户行为等，针对这些数据流进行实时或批量采集汇总，然后进行大数据分析是当前互联网的必备技术，通过消息队列完成此类数据收集是最好的选择。</p>
<h2 id="7-消息中间件常用协议"><a href="#7-消息中间件常用协议" class="headerlink" title="7.消息中间件常用协议"></a>7.消息中间件常用协议</h2><p> <strong>1 AMQP协议</strong></p>
<p>AMQP即Advanced Message Queuing Protocol,一个提供统一消息服务的应用层标准高级消息队列协议,是应用层协议的一个开放标准,为面向消息的中间件设计。基于此协议的客户端与消息中间件可传递消息，并不受客户端/中间件不同产品，不同开发语言等条件的限制。<br>优点：可靠、通用</p>
<p><strong>2 MQTT协议</strong></p>
<p>MQTT（Message Queuing Telemetry Transport，消息队列遥测传输）是IBM开发的一个即时通讯协议，有可能成为物联网的重要组成部分。该协议支持所有平台，几乎可以把所有联网物品和外部连接起来，被用来当做传感器和致动器（比如通过Twitter让房屋联网）的通信协议。<br>优点：格式简洁、占用带宽小、移动端通信、PUSH、嵌入式系统</p>
<p><strong>3 STOMP协议</strong></p>
<p>STOMP（Streaming Text Orientated Message Protocol）是流文本定向消息协议，是一种为MOM(Message Oriented Middleware，面向消息的中间件)设计的简单文本协议。STOMP提供一个可互操作的连接格式，允许客户端与任意STOMP消息代理（Broker）进行交互。<br>优点：命令模式（非topic\queue模式）</p>
<p><strong>4 XMPP协议</strong></p>
<p>XMPP（可扩展消息处理现场协议，Extensible Messaging and Presence Protocol）是基于可扩展标记语言（XML）的协议，多用于即时消息（IM）以及在线现场探测。适用于服务器之间的准即时操作。核心是基于XML流传输，这个协议可能最终允许因特网用户向因特网上的其他任何人发送即时消息，即使其操作系统和浏览器不同。<br>优点：通用公开、兼容性强、可扩展、安全性高，但XML编码格式占用带宽大</p>
<p><strong>5 其他基于TCP/IP自定义的协议</strong></p>
<p>有些特殊框架（如：redis、kafka、zeroMq等）根据自身需要未严格遵循MQ规范，而是基于TCP\IP自行封装了一套协议，通过网络socket接口进行传输，实现了MQ的功能。</p>
<h2 id="8-常见消息中间件"><a href="#8-常见消息中间件" class="headerlink" title="8.常见消息中间件"></a>8.常见消息中间件</h2><h5 id="1）RocketMQ"><a href="#1）RocketMQ" class="headerlink" title="1）RocketMQ"></a>1）RocketMQ</h5><p>阿里系下开源的一款分布式、队列模型的消息中间件，原名Metaq，3.0版本名称改为RocketMQ，是阿里参照kafka设计思想使用java实现的一套mq。同时将阿里系内部多款mq产品（Notify、metaq）进行整合，只维护核心功能，去除了所有其他运行时依赖，保证核心功能最简化，在此基础上配合阿里上述其他开源产品实现不同场景下mq的架构，目前主要多用于订单交易系统。该项目现已捐赠给Apache。</p>
<p>具有以下特点：</p>
<ul>
<li>能够保证严格的消息顺序</li>
<li>提供针对消息的过滤功能</li>
<li>提供丰富的消息拉取模式</li>
<li>高效的订阅者水平扩展能力</li>
<li>实时的消息订阅机制</li>
<li>亿级消息堆积能力</li>
</ul>
<p>与kafka的对比：<a href="https://rocketmq.apache.org/docs/motivation/" target="_blank" rel="noopener">https://rocketmq.apache.org/docs/motivation/</a></p>
<h5 id="2）RabbitMQ"><a href="#2）RabbitMQ" class="headerlink" title="2）RabbitMQ"></a>2）RabbitMQ</h5><p>兔子消息队列，暗示自己跑的快-_-  使用Erlang编写的一个开源的消息队列，本身支持很多的协议：AMQP，XMPP, SMTP,STOMP，也正是如此，使的它变的非常重量级，更适合于企业级的开发。同时实现了Broker架构，核心思想是生产者不会将消息直接发送给队列，消息在发送给客户端时先在中心队列排队。对路由(Routing)，负载均衡(Load balance)、数据持久化都有很好的支持。多用于进行企业级的ESB整合。</p>
<h5 id="3）ActiveMQ"><a href="#3）ActiveMQ" class="headerlink" title="3）ActiveMQ"></a>3）ActiveMQ</h5><p>Apache下的一个子项目。使用Java完全支持JMS1.1和J2EE 1.4规范的 JMS Provider实现，少量代码就可以高效地实现高级应用场景。可插拔的传输协议支持，比如：in-VM, TCP, SSL, NIO, UDP, multicast, JGroups and JXTA transports。RabbitMQ、ZeroMQ、ActiveMQ均支持常用的多种语言客户端 C++、Java、.Net,、Python、 Php、 Ruby等。</p>
<p>4）</p>
<h5 id="4）Redis"><a href="#4）Redis" class="headerlink" title="4）Redis"></a>4）Redis</h5><p>使用C语言开发的一个Key-Value的NoSQL数据库，开发维护很活跃，虽然它是一个Key-Value数据库存储系统，但它本身支持MQ功能，所以完全可以当做一个轻量级的队列服务来使用。对于RabbitMQ和Redis的入队和出队操作，各执行100万次，每10万次记录一次执行时间。测试数据分为128Bytes、512Bytes、1K和10K四个不同大小的数据。实验表明：入队时，当数据比较小时Redis的性能要高于RabbitMQ，而如果数据大小超过了10K，Redis则慢的无法忍受；出队时，无论数据大小，Redis都表现出非常好的性能，而RabbitMQ的出队性能则远低于Redis。</p>
<h5 id="5）Kafka"><a href="#5）Kafka" class="headerlink" title="5）Kafka"></a>5）Kafka</h5><p>Apache下的一个子项目，使用scala实现的一个高性能分布式Publish/Subscribe消息队列系统，具有以下特性：</p>
<ul>
<li>快速持久化：通过磁盘顺序读写与零拷贝机制，可以在O(1)的系统开销下进行消息持久化；</li>
<li>高吞吐：在一台普通的服务器上既可以达到10W/s的吞吐速率；</li>
<li>高堆积：支持topic下消费者较长时间离线，消息堆积量大；</li>
<li>完全的分布式系统：Broker、Producer、Consumer都原生自动支持分布式，依赖zookeeper自动实现复杂均衡；</li>
<li>支持Hadoop数据并行加载：对于像Hadoop的一样的日志数据和离线分析系统，但又要求实时处理的限制，这是一个可行的解决方案。</li>
</ul>
<h5 id="6）ZeroMQ"><a href="#6）ZeroMQ" class="headerlink" title="6）ZeroMQ"></a>6）ZeroMQ</h5><p>号称最快的消息队列系统，专门为高吞吐量/低延迟的场景开发，在金融界的应用中经常使用，偏重于实时数据通信场景。ZMQ能够实现RabbitMQ不擅长的高级/复杂的队列，但是开发人员需要自己组合多种技术框架，开发成本高。因此ZeroMQ具有一个独特的非中间件的模式，更像一个socket library，你不需要安装和运行一个消息服务器或中间件，因为你的应用程序本身就是使用ZeroMQ API完成逻辑服务的角色。但是ZeroMQ仅提供非持久性的队列，如果down机，数据将会丢失。如：Twitter的Storm中使用ZeroMQ作为数据流的传输。</p>
<p>ZeroMQ套接字是与传输层无关的：ZeroMQ套接字对所有传输层协议定义了统一的API接口。默认支持 进程内(inproc) ，进程间(IPC) ，多播，TCP协议，在不同的协议之间切换只要简单的改变连接字符串的前缀。可以在任何时候以最小的代价从进程间的本地通信切换到分布式下的TCP通信。ZeroMQ在背后处理连接建立，断开和重连逻辑。</p>
<p>特性：</p>
<ul>
<li>无锁的队列模型：对于跨线程间的交互（用户端和session）之间的数据交换通道pipe，采用无锁的队列算法CAS；在pipe的两端注册有异步事件，在读或者写消息到pipe的时，会自动触发读写事件。</li>
<li>批量处理的算法：对于批量的消息，进行了适应性的优化，可以批量的接收和发送消息。</li>
<li>多核下的线程绑定，无须CPU切换：区别于传统的多线程并发模式，信号量或者临界区，zeroMQ充分利用多核的优势，每个核绑定运行一个工作者线程，避免多线程之间的CPU切换开销。</li>
</ul>
<h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><p><img src="C:\Users\nexxt\Desktop\Temp.assets\20170816171523564.jpg" alt=""></p>
<h2 id="9-MQ使用场景"><a href="#9-MQ使用场景" class="headerlink" title="9.MQ使用场景"></a>9.MQ使用场景</h2><h5 id="1）异步处理"><a href="#1）异步处理" class="headerlink" title="1）异步处理"></a>1）异步处理</h5><p>场景说明：用户注册后，需要发注册邮件和注册短信。传统的做法有两种 1.串行的方式；2.并行方式</p>
<p>a、串行方式：将注册信息写入数据库成功后，发送注册邮件，再发送注册短信。以上三个任务全部完成后，返回给客户端。</p>
<p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\1.jpg" alt=""></p>
<p>b、并行方式：将注册信息写入数据库成功后，发送注册邮件的同时，发送注册短信。以上三个任务完成后，返回给客户端。与串行的差别是，并行的方式可以提高处理的时间.</p>
<p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\2.jpg" alt=""></p>
<p>假设三个业务节点每个使用50毫秒钟，不考虑网络等其他开销，则串行方式的时间是150毫秒，并行的时间可能是100毫秒。<br>因为CPU在单位时间内处理的请求数是一定的，假设CPU1秒内吞吐量是100次。则串行方式1秒内CPU可处理的请求量是7次（1000/150）。并行方式处理的请求量是10次（1000/100）<br>小结：如以上案例描述，传统的方式系统的性能（并发量，吞吐量，响应时间）会有瓶颈。如何解决这个问题呢？</p>
<p>引入消息队列，将不是必须的业务逻辑，异步处理。改造后的架构如下：</p>
<p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\3.jpg" alt=""></p>
<p>按照以上约定，用户的响应时间相当于是注册信息写入数据库的时间，也就是50毫秒。注册邮件，发送短信写入消息队列后，直接返回，因此写入消息队列的速度很快，基本可以忽略，因此用户的响应时间可能是50毫秒。因此架构改变后，系统的吞吐量提高到每秒20 QPS。比串行提高了3倍，比并行提高了两倍。</p>
<h5 id="2）应用解耦"><a href="#2）应用解耦" class="headerlink" title="2）应用解耦"></a>2）应用解耦</h5><p>场景说明：用户下单后，订单系统需要通知库存系统。传统的做法是，订单系统调用库存系统的接口。如下：</p>
<pre><code>订单系统----------------&gt;库存系统（增减库存）
</code></pre><p>传统模式的缺点：假如库存系统无法访问，则订单减库存将失败，从而导致订单失败，订单系统与库存系统耦合，解决以上问题则需要引入消息队列，订单系统写入队列中，库存系统出现问题时，消息队列中的消息是没有被消费的，知道库存上线消费，保证了消息的可靠性。</p>
<h5 id="3）流量削峰"><a href="#3）流量削峰" class="headerlink" title="3）流量削峰"></a>3）流量削峰</h5><p>流量削锋也是消息队列中的常用场景，一般在秒杀或团抢活动中使用广泛。 应用场景：秒杀活动，一般会因为流量过大，导致流量暴增，应用挂掉。为解决这个问题，一般需要在应用前端加入消息队列。</p>
<p>a、可以控制活动的人数      </p>
<p>b、可以缓解短时间内高流量压垮应用</p>
<p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\4.jpg" alt=""></p>
<p>用户的请求，服务器接收后，首先写入消息队列。假如消息队列长度超过最大数量(即商品数量)，则直接抛弃用户请求或跳转到错误页面。 秒杀业务根据消息队列中的请求信息，再做后续处理。</p>
<h5 id="4）日志处理"><a href="#4）日志处理" class="headerlink" title="4）日志处理"></a>4）日志处理</h5><p>日志处理是指将消息队列用在日志处理中，比如Kafka的应用，解决大量日志传输的问题。架构简化如下</p>
<p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\5.jpg" alt=""></p>
<p>日志采集客户端，负责日志数据采集，定时写受写入Kafka队列 Kafka消息队列，负责日志数据的接收，存储和转发 日志处理应用：订阅并消费kafka队列中的日志数据 .</p>
<h5 id="5）消息通讯"><a href="#5）消息通讯" class="headerlink" title="5）消息通讯"></a>5）消息通讯</h5><p>消息通讯是指，消息队列一般都内置了高效的通信机制，因此也可以用在纯的消息通讯。比如实现点对点消息队列，或者聊天室等            </p>
<p>点对点通讯：</p>
<p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\点对点.jpg" alt=""></p>
<p>客户端A和客户端B使用同一队列，进行消息通讯。</p>
<p>聊天室通讯：</p>
<p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\聊天室.jpg" alt=""></p>
<h2 id="10-消息中间件示例"><a href="#10-消息中间件示例" class="headerlink" title="10.消息中间件示例"></a>10.消息中间件示例</h2><h4 id="1）电商系统"><a href="#1）电商系统" class="headerlink" title="1）电商系统"></a>1）电商系统</h4><p><img src="C:\Users\nexxt\Desktop\消息队列概述.assets\电商.jpg" alt=""></p>
<p>消息队列采用高可用，可持久化的消息中间件。比如Active MQ，Rabbit MQ，Rocket Mq。 （1）应用将主干逻辑处理完成后，写入消息队列。消息发送是否成功可以开启消息的确认模式。（消息队列返回消息接收成功状态后，应用再返回，这样保障消息的完整性） （2）扩展流程（发短信，配送处理）订阅队列消息。采用推或拉的方式获取消息并处理。 （3）消息将应用解耦的同时，带来了数据一致性问题，可以采用最终一致性方式解决。比如主数据写入数据库，扩展应用根据消息队列，并结合数据库方式实现基于消息队列的后续处理。</p>
<h4 id="2）日志收集系统"><a href="#2）日志收集系统" class="headerlink" title="2）日志收集系统"></a>2）日志收集系统</h4><p><img src="F:\Hexo\test\source\_posts\activeMQ1\日志.jpg" alt=""></p>
<p>分为Zookeeper注册中心，日志收集客户端，Kafka集群和Storm集群（OtherApp）四部分组成。 Zookeeper注册中心，提出负载均衡和地址查找服务 日志收集客户端，用于采集应用系统的日志，并将数据推送到kafka队列 Kafka集群：接收，路由，存储，转发等消息处理 Storm集群：与OtherApp处于同一级别，采用拉的方式消费队列中的数据。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/消息中间件/" rel="tag"># 消息中间件</a>
          
            <a href="/tags/ActiveMQ/" rel="tag"># ActiveMQ</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/16/Java8-Stream/" rel="next" title="Java8函数式数据处理-Stream">
                <i class="fa fa-chevron-left"></i> Java8函数式数据处理-Stream
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/17/ActiveMQ的使用/" rel="prev" title="ActiveMQ的使用">
                ActiveMQ的使用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MjIzMy8xODc4MA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">nexxt95</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MQ详解及中间件产品比较"><span class="nav-number">1.</span> <span class="nav-text">MQ详解及中间件产品比较</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-jms的概念"><span class="nav-number">1.1.</span> <span class="nav-text">1.jms的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-jms中关键的对象"><span class="nav-number">1.2.</span> <span class="nav-text">2.jms中关键的对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-消息中间件的组成"><span class="nav-number">1.3.</span> <span class="nav-text">3.消息中间件的组成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-消息机制-点对点与发布订阅"><span class="nav-number">1.4.</span> <span class="nav-text">4.消息机制-点对点与发布订阅</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-p2p-点对点"><span class="nav-number">1.4.0.0.0.1.</span> <span class="nav-text">1.p2p(点对点)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-pub-and-sub-发布订阅"><span class="nav-number">1.4.0.0.0.2.</span> <span class="nav-text">2.pub and sub(发布订阅)</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#5-消息中间件的优势"><span class="nav-number">1.5.</span> <span class="nav-text">5.消息中间件的优势</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1）系统解耦"><span class="nav-number">1.5.0.0.1.</span> <span class="nav-text">1）系统解耦</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2）提高系统响应时间"><span class="nav-number">1.5.0.0.2.</span> <span class="nav-text">2）提高系统响应时间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3）为大数据处理架构提供服务"><span class="nav-number">1.5.0.0.3.</span> <span class="nav-text">3）为大数据处理架构提供服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-消息中间件的应用场景"><span class="nav-number">1.6.</span> <span class="nav-text">6.消息中间件的应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1）异步通信"><span class="nav-number">1.6.0.0.1.</span> <span class="nav-text">1）异步通信</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2）解耦"><span class="nav-number">1.6.0.0.2.</span> <span class="nav-text">2）解耦</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3）冗余"><span class="nav-number">1.6.0.0.3.</span> <span class="nav-text">3）冗余</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4）扩展性"><span class="nav-number">1.6.0.0.4.</span> <span class="nav-text">4）扩展性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5）过载保护"><span class="nav-number">1.6.0.0.5.</span> <span class="nav-text">5）过载保护</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6）可恢复性"><span class="nav-number">1.6.0.0.6.</span> <span class="nav-text">6）可恢复性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7）顺序保证"><span class="nav-number">1.6.0.0.7.</span> <span class="nav-text">7）顺序保证</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8）缓冲"><span class="nav-number">1.6.0.0.8.</span> <span class="nav-text">8）缓冲</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9）数据流处理"><span class="nav-number">1.6.0.0.9.</span> <span class="nav-text">9）数据流处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-消息中间件常用协议"><span class="nav-number">1.7.</span> <span class="nav-text">7.消息中间件常用协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-常见消息中间件"><span class="nav-number">1.8.</span> <span class="nav-text">8.常见消息中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1）RocketMQ"><span class="nav-number">1.8.0.0.1.</span> <span class="nav-text">1）RocketMQ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2）RabbitMQ"><span class="nav-number">1.8.0.0.2.</span> <span class="nav-text">2）RabbitMQ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3）ActiveMQ"><span class="nav-number">1.8.0.0.3.</span> <span class="nav-text">3）ActiveMQ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4）Redis"><span class="nav-number">1.8.0.0.4.</span> <span class="nav-text">4）Redis</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5）Kafka"><span class="nav-number">1.8.0.0.5.</span> <span class="nav-text">5）Kafka</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6）ZeroMQ"><span class="nav-number">1.8.0.0.6.</span> <span class="nav-text">6）ZeroMQ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#比较"><span class="nav-number">1.9.</span> <span class="nav-text">比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-MQ使用场景"><span class="nav-number">1.10.</span> <span class="nav-text">9.MQ使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1）异步处理"><span class="nav-number">1.10.0.0.1.</span> <span class="nav-text">1）异步处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2）应用解耦"><span class="nav-number">1.10.0.0.2.</span> <span class="nav-text">2）应用解耦</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3）流量削峰"><span class="nav-number">1.10.0.0.3.</span> <span class="nav-text">3）流量削峰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4）日志处理"><span class="nav-number">1.10.0.0.4.</span> <span class="nav-text">4）日志处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5）消息通讯"><span class="nav-number">1.10.0.0.5.</span> <span class="nav-text">5）消息通讯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-消息中间件示例"><span class="nav-number">1.11.</span> <span class="nav-text">10.消息中间件示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1）电商系统"><span class="nav-number">1.11.0.1.</span> <span class="nav-text">1）电商系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2）日志收集系统"><span class="nav-number">1.11.0.2.</span> <span class="nav-text">2）日志收集系统</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nexxt95</span>

  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
